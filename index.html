<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='utf-8' />
  <title>FullCalendar - Drag, Remove & Refresh Example</title>
  <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
  <link href='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.8/index.global.min.css' rel='stylesheet' />
  <style>
    body {
      margin: 40px 10px;
      padding: 0;
      font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
      font-size: 14px;
    }

    #external-events {
      padding: 10px;
      border: 1px solid #ccc;
      background: #f8f9fa;
      margin-bottom: 20px;
    }

    #external-events .fc-event {
      margin: 5px 0;
      cursor: move;
      padding: 5px;
      background: #3788d8;
      color: white;
      border-radius: 3px;
    }

    #calendar {
      max-width: 1200px;
      margin: 0 auto;
    }

    .controls {
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <div class="container-fluid">
    <h2>FullCalendar: Drag, Remove & Refresh Example</h2>

    <div class="row">
      <div class="col-md-3">
        <div id='external-events'>
          <h4>Draggable Events</h4>
          <div class='fc-event' data-event='{"title":"Morning Shift","duration":"04:00"}'>
            Morning Shift (4h)
          </div>
          <div class='fc-event' data-event='{"title":"Afternoon Shift","duration":"04:00"}'>
            Afternoon Shift (4h)
          </div>
          <div class='fc-event' data-event='{"title":"Night Shift","duration":"08:00"}'>
            Night Shift (8h)
          </div>
          <div class='fc-event' data-event='{"title":"Full Day","duration":"08:00","color":"green"}'>
            Full Day (8h)
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <div class="controls">
          <button id="btn-remove-all" class="btn btn-danger">Remove All Events</button>
          <button id="btn-cleanup-no-id" class="btn btn-warning">Cleanup Events Without ID</button>
          <button id="btn-refetch-source1" class="btn btn-primary">Refetch Source 1</button>
          <button id="btn-refetch-source2" class="btn btn-info">Refetch Source 2</button>
          <button id="btn-refetch-all" class="btn btn-success">Refetch All Sources</button>
          <span id="event-count" class="ms-3">Events: 0</span>
        </div>

        <div id='calendar'></div>
      </div>
    </div>
  </div>

  <script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.8/index.global.min.js'></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      var calendarEl = document.getElementById('calendar');

      // Initialize FullCalendar
      var calendar = new FullCalendar.Calendar(calendarEl, {
        schedulerLicenseKey: 'CC-Attribution-NonCommercial-NoDerivatives',
        initialView: 'resourceTimelineMonth',
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'resourceTimelineMonth,resourceTimelineWeek,resourceTimelineDay'
        },
        resourceGroupField: 'building',
        resources: './resources.json',
        editable: true,
        droppable: true,

        // Event sources (can be refetched independently)
        eventSources: [
          {
            id: 'source1',
            url: './source1.json',
            color: 'purple'
          },
          {
            id: 'source2',
            url: './source2.json',
            color: 'orange'
          }
        ],

        // When external event is dropped
        eventReceive: function(info) {
          console.log('Event received:', info.event.title);
          updateEventCount();

          // You can make an AJAX call here
          // $.ajax({...});
        },

        // When event is dragged
        eventDrop: function(info) {
          console.log('Event dropped:', info.event.title);
        },

        // When event is resized
        eventResize: function(info) {
          console.log('Event resized:', info.event.title);
        },

        // When event is clicked
        eventClick: function(info) {
          console.log('Event clicked:', info.event.title, 'ID:', info.event.id || 'no ID');
        },

        // After events are rendered
        eventsSet: function(events) {
          updateEventCount();
        }
      });

      calendar.render();

      // Make external events draggable
      var draggableEl = document.getElementById('external-events');
      new FullCalendar.Draggable(draggableEl, {
        itemSelector: '.fc-event',
        eventData: function(eventEl) {
          var data = JSON.parse(eventEl.getAttribute('data-event'));
          return {
            // Explicitly no ID - dragged events should not have IDs
            title: data.title,
            duration: data.duration,
            color: data.color || '#3788d8'
          };
        }
      });

      // Update event count
      function updateEventCount() {
        var count = calendar.getEvents().length;
        document.getElementById('event-count').textContent = 'Events: ' + count;
      }

      // Button: Remove all events
      document.getElementById('btn-remove-all').addEventListener('click', function() {
        if (confirm('Remove all events from calendar?')) {
          calendar.removeAllEvents();
          updateEventCount();
          console.log('All events removed');
        }
      });

      // Button: Cleanup events without ID
      document.getElementById('btn-cleanup-no-id').addEventListener('click', function() {
        var eventsWithoutId = calendar.getEvents().filter(function(event) {
          return !event.id;
        });

        if (eventsWithoutId.length === 0) {
          console.log('No events without ID found');
          return;
        }

        if (confirm('Remove ' + eventsWithoutId.length + ' event(s) without ID?')) {
          eventsWithoutId.forEach(function(event) {
            console.log('Removing event without ID:', event);
            event.remove();
          });
          updateEventCount();
          console.log('Removed ' + eventsWithoutId.length + ' events without ID');
        }
      });

      // Button: Cleanup events without ID
      document.getElementById('btn-cleanup-no-id').addEventListener('click', function() {
        var eventsWithoutId = calendar.getEvents().filter(function(event) {
          return !event.id;
        });
        console.log('Events without ID:', eventsWithoutId);
        if (eventsWithoutId.length === 0) {
          console.log('No events without ID found');
          return;
        }

        if (confirm('Remove ' + eventsWithoutId.length + ' event(s) without ID?')) {
          eventsWithoutId.forEach(function(event) {
            event.remove();
          });
          updateEventCount();
          console.log('Removed ' + eventsWithoutId.length + ' events without ID');
        }
      });

      // Button: Refetch Source 1
      document.getElementById('btn-refetch-source1').addEventListener('click', function() {
        console.log('Refetching Source 1...');
        var source = calendar.getEventSourceById('source1');
        if (source) {
          source.refetch();
        }
      });

      // Button: Refetch Source 2
      document.getElementById('btn-refetch-source2').addEventListener('click', function() {
        console.log('Refetching Source 2...');
        var source = calendar.getEventSourceById('source2');
        if (source) {
          source.refetch();
        }
      });

      // Button: Refetch all sources
      document.getElementById('btn-refetch-all').addEventListener('click', function() {
        console.log('Refetching all sources...');
        calendar.refetchEvents();
        // Alternative: calendar.refetchResources();
      });

      // Initial count
      updateEventCount();

      // Make calendar globally accessible for debugging
      window.calendar = calendar;
    });
  </script>

</body>
</html>
